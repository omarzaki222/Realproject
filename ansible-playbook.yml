- name: "Build and run Docker container with Ansible"
  hosts: localhost
  tasks:
    - name: Remove old container if it exists
      command: sudo docker stop ansi
      ignore_errors: yes

    - name: Remove old container
      command: docker rm -f ansi
      ignore_errors: yes

    - name: Build Docker image from Dockerfile
      command: docker build -t ansible-img .

    - name: Login to Docker Hub
      command: docker login -u omarzaki222 -p 01118001235@ZzZ

    - name: Tag the image
      command: docker tag ansible-img omarzaki222/python:latest

    - name: Run container from ansible-img
      command: docker run -d --name ansi -p 5000:5000 ansible-img

    - name: Push Docker image to Docker Hub
      command: docker push omarzaki222/python:latest
